import{k as O,a as Y,b as D,v as x,c as R,d as J,r as ee,M as $,g as ae,s as te,e as se,f as ne,i as oe,j as le,l as re,m as N,w as S}from"../app.25a6dac8.js";import{n as P,O as Q,c as z,p as K,q as l,s as d,v as t,D as m,u as n,x as V,y as I,I as b,A as X,Z as F,z as L,F as M,t as A,H as j,L as B,E as ce,G as ie,_ as T,r as E,aw as W,ax as G,w as ue,a2 as de,ab as pe,X as q,e as he,a8 as H}from"./framework.3f494197.js";import"./theme.4cab993e.js";const U=_=>(ce("data-v-3765432c"),_=_(),ie(),_),me=["href"],ve={class:"header"},_e={class:"left"},ge={class:"main"},fe={class:"top"},ke={class:"title"},ye={class:"bottom"},we={class:"rating"},$e={class:"right"},Ve={class:"footer"},Ce=["href"],be=U(()=>t("span",{class:"spacer"},null,-1)),Me=["href"],ze=U(()=>t("span",{class:"spacer"},null,-1)),Se=U(()=>t("span",{class:"spacer"},null,-1)),Ie=U(()=>t("span",{class:"spacer grow"},null,-1)),Le={class:"avatars"},Be=["onClick"],Fe=["src"],De=P({__name:"package",props:{data:{},gravatar:{}},emits:["query"],setup(_){const r=_,g=Q(O,{}),v=Y(),a=z(()=>r.data.package.links.homepage||r.data.package.links.repository),p=z(()=>{var e,h;for(const s in D)if(!((h=(e=D[s]).hidden)!=null&&h.call(e,g,"card"))&&x(r.data,D[s].query))return{type:s,...D[s]}});function i(e){return(r.gravatar||"https://s.gravatar.com")+"/avatar/"+(e?te.hash(e.toLowerCase()):"")+".png?d=mp"}function f(e){return e>=100?+e.toFixed():+e.toFixed(1)}function y(e){return e>=(1<<20)*1e3?f(e/(1<<30))+" GB":e>=1024*1e3?f(e/(1<<20))+" MB":f(e/1024)+" KB"}const{t:k,setLocaleMessage:c}=R({messages:{"zh-CN":J}});function o(e){const h=new Date,s=new Date(e),u=h.getTime()-s.getTime();return u<3e4?k("time.just-now"):u<36e5?k("time.minutes-ago",[Math.floor(u/6e4)]):u<864e5?k("time.hours-ago",[Math.floor(u/36e5)]):u<6048e5?k("time.days-ago",[Math.floor(u/864e5)]):s.toLocaleDateString()}return(e,h)=>{const s=K("el-tooltip"),u=K("k-markdown");return l(),d("a",{class:"market-package",target:"_blank",href:a.value},[t("div",ve,[t("div",_e,[m(n($),{name:"outline:"+n(ee)(e.data.category)},null,8,["name"])]),t("div",ge,[t("h2",fe,[t("span",ke,V(e.data.shortname),1),p.value?(l(),I(s,{key:0,placement:"right",content:n(k)(`badge.${p.value.type}`)},{default:b(()=>[t("span",{class:X(["icon",p.value.type]),onClick:h[0]||(h[0]=F(w=>e.$emit("query",p.value.query),["stop","prevent"]))},[m(n($),{name:p.value.type},null,8,["name"])],2)]),_:1},8,["content"])):L("",!0)]),t("div",ye,[m(s,{content:Math.max(Math.min(e.data.rating??0,5),0).toFixed(1),placement:"right"},{default:b(()=>[t("div",we,[(l(!0),d(M,null,A(Array(5).fill(null),(w,C)=>(l(),I(n($),{key:C,name:C+.5<e.data.rating?"star-full":"star-empty"},null,8,["name"]))),128))])]),_:1},8,["content"])])]),t("div",$e,[j(e.$slots,"action",{},void 0,!0)])]),m(u,{inline:"",class:"desc",source:e.data.manifest?n(v)(e.data.manifest.description):e.data.package.description??""},null,8,["source"]),t("div",Ve,[m(s,{content:o(e.data.updatedAt),placement:"top"},{default:b(()=>[t("a",{class:"shrink",target:"_blank",href:e.data.package.links.npm},[m(n($),{name:"tag"}),B(V(e.data.package.version),1)],8,Ce)]),_:1},8,["content"]),e.data.installSize?(l(),d(M,{key:0},[be,t("a",{target:"_blank",href:e.data.package.links.size},[m(n($),{name:"file-archive"}),B(V(y(e.data.installSize)),1)],8,Me)],64)):L("",!0),e.data.downloads?(l(),d(M,{key:1},[ze,t("span",null,[m(n($),{name:"download"}),B(V(e.data.downloads.lastMonth),1)])],64)):L("",!0),!e.data.installSize&&!e.data.downloads?(l(),d(M,{key:2},[Se,t("span",null,[m(n($),{name:"balance"}),B(V(e.data.license),1)])],64)):L("",!0),Ie,t("div",Le,[(l(!0),d(M,null,A(n(ae)(e.data),({email:w,name:C})=>(l(),I(s,{key:C,content:C,placement:"top"},{default:b(()=>[t("span",{class:"avatar",onClick:F(Z=>e.$emit("query","email:"+w),["stop","prevent"])},[t("img",{src:i(w)},null,8,Fe)],8,Be)]),_:2},1032,["content"]))),128))])])],8,me)}}}),Ne=T(De,[["__scopeId","data-v-3765432c"]]),qe={class:"market-list"},Ke={class:"market-container"},Ae=P({__name:"list",props:{modelValue:{},data:{},installed:{type:Function},gravatar:{}},emits:["update:modelValue"],setup(_,{emit:r}){const g=_,v=Q(O,{}),a=z(()=>se(g.data,g.modelValue)),p=z(()=>ne(a.value,g.modelValue,v)),i=z(()=>{for(const c of g.modelValue)if(c.startsWith("limit:")){const o=parseInt(c.slice(6));if(o)return o}return 24}),f=E(1),y=z(()=>{const c=[];for(let o=0;o<p.value.length;o+=i.value)c.push(p.value.slice(o,o+i.value));return c});function k(c){const o=g.modelValue.slice();o[o.length-1]||o.pop(),o.includes(c)||o.push(c),o.push(""),r("update:modelValue",o)}return(c,o)=>{const e=K("el-pagination");return l(),d("div",qe,[j(c.$slots,"header",W(G({all:a.value,packages:p.value,hasFilter:n(oe)(c.modelValue)})),void 0,!0),t("div",Ke,[(l(!0),d(M,null,A(y.value[f.value-1],h=>(l(),I(Ne,{key:h.package.name,class:"k-card",data:h,gravatar:c.gravatar,onQuery:k},{action:b(()=>[j(c.$slots,"action",W(G(h)),void 0,!0)]),_:2},1032,["data","gravatar"]))),128))]),m(e,{class:"pagination",background:"","current-page":f.value,"onUpdate:currentPage":o[0]||(o[0]=h=>f.value=h),"pager-count":5,"page-size":i.value,total:p.value.length,layout:"prev, pager, next"},null,8,["current-page","page-size","total"])])}}}),Ee=T(Ae,[["__scopeId","data-v-fc1e7b62"]]),Pe={class:"search-box"},Te={class:"search-container"},Ue=["onClick"],je=["placeholder","onKeydown","onKeypress"],We=["onClick"],Ge=P({__name:"search",props:{modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(_,{emit:r}){const g=_,v=E(),a=E();ue(()=>g.modelValue,s=>{a.value=s.slice()},{immediate:!0,deep:!0});const p=re(()=>{r("update:modelValue",a.value)},100),i=z({get:()=>a.value[a.value.length-1],set:s=>{a.value[a.value.length-1]=s.toLowerCase(),p()}});function f(s){var u;a.value.splice(s,1),r("update:modelValue",a.value),(u=v.value)==null||u.focus()}function y(){const s=a.value[a.value.length-1];s&&(a.value.slice(0,-1).includes(s)&&a.value.pop(),a.value.push(""),r("update:modelValue",a.value))}function k(s){a.value[a.value.length-1]="",r("update:modelValue",a.value)}function c(s){a.value[a.value.length-1]===""&&a.value.length>1&&(s.preventDefault(),a.value.splice(a.value.length-2,1),r("update:modelValue",a.value))}function o(){a.value=[""],r("update:modelValue",a.value)}const{t:e,setLocaleMessage:h}=R({messages:{"zh-CN":J}});return(s,u)=>(l(),d("div",Pe,[t("div",Te,[(l(!0),d(M,null,A(s.modelValue.slice(0,-1),(w,C)=>(l(),d("span",{key:C,class:X(["search-word",{invalid:!n(le)(w)}]),onClick:Z=>f(C)},V(w),11,Ue))),128)),de(t("input",{placeholder:n(e)("search.placeholder"),"onUpdate:modelValue":u[0]||(u[0]=w=>i.value=w),ref_key:"input",ref:v,onBlur:y,onKeydown:[q(k,["escape"]),q(c,["backspace"])],onKeypress:[q(F(y,["prevent"]),["enter"]),q(F(y,["prevent"]),["space"])]},null,40,je),[[pe,i.value]])]),t("div",{class:"search-action",onClick:F(o,["stop"])},[m(n($),{class:"search",name:"search"}),m(n($),{class:"close",name:"close"})],8,We)]))}}),He=T(Ge,[["__scopeId","data-v-f6f5a36d"]]),Oe={},Re={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512"},Je=t("path",{fill:"currentColor",d:"M379.8 197.6c5.031-7.344 5.563-16.88 1.406-24.75C377.1 164.9 368.9 160 360 160h-156.6l50.84-127.1c2.969-7.375 2.062-15.78-2.406-22.38S239.1 0 232 0h-176C43.97 0 33.81 8.906 32.22 20.84l-32 240C-.7179 267.7 1.376 274.6 5.938 279.8C10.5 285 17.09 288 24 288h146.3l-41.78 194.1c-2.406 11.22 3.469 22.56 14 27.09C145.6 511.4 148.8 512 152 512c7.719 0 15.22-3.75 19.81-10.44L379.8 197.6zM190.1 256H33.15l29.87-224h157.2L164.9 170.1C160.7 180.6 168.5 192 179.8 192h165l-176.5 257.1l37.43-174.6C207.9 265.4 200.3 256 190.1 256z"},null,-1),Qe=[Je];function Xe(_,r){return l(),d("svg",Re,Qe)}const Ze=T(Oe,[["render",Xe]]),Ye=t("h1",null,"插件市场",-1),xe={class:"info"},ea={class:"timestamp"},aa=["href"],ta={key:1,class:"market-loading"},sa={key:0},na={key:1},ca=P({__name:"market",setup(_){const r=E();he(async()=>{try{N.refresh()}catch(v){r.value=v}});function g(v){return`https://koishi.online/plugins/${v}?share=`+btoa(JSON.stringify({share:{name:v},plugins:{[`~${v}`]:{}}}))}return(v,a)=>{const p=K("el-tooltip");return n(N)?(l(),I(n(Ee),{key:0,gravatar:"https://cravatar.cn",modelValue:n(S),"onUpdate:modelValue":a[1]||(a[1]=i=>H(S)?S.value=i:null),data:n(N).objects},{header:b(({hasFilter:i,all:f,packages:y})=>[Ye,t("div",xe,[B(" 当前共有 "+V(i?y.length+" / ":"")+V(f.length)+" 个可用于 v4 版本的插件 ",1),t("span",ea,"("+V(new Date(n(N).time).toLocaleString())+")",1)]),m(n(He),{class:"k-card",modelValue:n(S),"onUpdate:modelValue":a[0]||(a[0]=k=>H(S)?S.value=k:null)},null,8,["modelValue"])]),action:b(i=>[i.portable?(l(),I(p,{key:0,content:"快速体验",placement:"bottom"},{default:b(()=>[t("a",{class:"portable-button",href:g(i.shortname),rel:"noopener noreferer",target:"_blank"},[m(Ze)],8,aa)]),_:2},1024)):L("",!0)]),_:1},8,["modelValue","data"])):(l(),d("div",ta,[r.value?(l(),d("div",sa," 插件市场加载失败。 ")):(l(),d("div",na," 正在加载插件市场…… "))]))}}});export{ca as default};
